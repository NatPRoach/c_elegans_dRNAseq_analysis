#!/usr/bin/env bash

echo "L1"
# cat full_lengths/realigned/split/ce11_gen_L1_bio1_tech1_Minimap2_k14.ss_filtered.bed full_lengths/realigned/split/ce11_gen_L1_bio1_tech2_Minimap2_k14.ss_filtered.bed > full_lengths/realigned/L1_full_length.bed
#
# ./correctBed12_v9.py full_lengths/realigned/L1_full_length.realign.bed correctionLogs/L1_realigned > full_lengths/realigned/L1_full_length.corrected.bed
#
# ./filter_intron_retained.py full_lengths/realigned/L1_full_length.corrected.bedfa full_lengths/realigned/L1_full_length.no_intron.bedfa full_lengths/realigned/L1_full_length.intron.bedfa

bedtools getfasta -s -split -bedOut -fi ../../references/ce11/ce11.fa -bed ../../data/L1/combined/L1_full_length.no_intron.bed > ../../data/L1/combined/L1_full_length.no_intron.bedfa

./extractIsoforms.py ../../results/correctionLogs/L1.gene.txt ../../data/L1/combined/L1_full_length.no_intron.bedfa ../../results/isoforms/L1_isoforms.tsv

./getNewIsoforms.py ../../results/isoforms/L1_isoforms.tsv > ../../results/new_isoforms/L1_new_isoforms.tsv

./annotate_bedUTRs.py ../../results/isoforms/L1_isoforms.tsv ../../data/L1/combined/L1_full_length.no_intron.bed ../../data/L1/combined/L1_full_length.no_intron.annotated.bed

echo "L2"
# cat full_lengths/realigned/split/ce11_gen_L2_bio1_tech1_Minimap2_k14.ss_filtered.bed full_lengths/realigned/split/ce11_gen_L2_bio1_tech2_Minimap2_k14.ss_filtered.bed > full_lengths/realigned/L2_full_length.bed
#
# ./correctBed12_v9.py full_lengths/realigned/L2_full_length.realign.bed correctionLogs/L2_realigned > full_lengths/realigned/L2_full_length.corrected.bed
#
# ./filter_intron_retained.py full_lengths/realigned/L2_full_length.corrected.bedfa full_lengths/realigned/L2_full_length.no_intron.bedfa full_lengths/realigned/L2_full_length.intron.bedfa

bedtools getfasta -s -split -bedOut -fi ../../references/ce11/ce11.fa -bed ../../data/L2/combined/L2_full_length.no_intron.bed > ../../data/L2/combined/L2_full_length.no_intron.bedfa

./extractIsoforms.py ../../results/correctionLogs/L2.gene.txt ../../data/L2/combined/L2_full_length.no_intron.bedfa ../../results/isoforms/L2_isoforms.tsv

./getNewIsoforms.py ../../results/isoforms/L2_isoforms.tsv > ../../results/new_isoforms/L2_new_isoforms.tsv

./annotate_bedUTRs.py ../../results/isoforms/L2_isoforms.tsv ../../data/L2/combined/L2_full_length.no_intron.bed ../../data/L2/combined/L2_full_length.no_intron.annotated.bed

echo "L3"
# cat full_lengths/realigned/split/ce11_gen_L3_bio1_tech1_Minimap2_k14.ss_filtered.bed full_lengths/realigned/split/ce11_gen_L3_bio1_tech2_Minimap2_k14.ss_filtered.bed > full_lengths/realigned/L3_full_length.bed
#
# ./correctBed12_v9.py full_lengths/realigned/L3_full_length.realign.bed correctionLogs/L3_realigned > full_lengths/realigned/L3_full_length.corrected.bed
#
# ./filter_intron_retained.py full_lengths/realigned/L3_full_length.corrected.bedfa full_lengths/realigned/L3_full_length.no_intron.bedfa full_lengths/realigned/L3_full_length.intron.bedfa

bedtools getfasta -s -split -bedOut -fi ../../references/ce11/ce11.fa -bed ../../data/L3/combined/L3_full_length.no_intron.bed > ../../data/L3/combined/L3_full_length.no_intron.bedfa

./extractIsoforms.py ../../results/correctionLogs/L3.gene.txt ../../data/L3/combined/L3_full_length.no_intron.bedfa ../../results/isoforms/L3_isoforms.tsv

./getNewIsoforms.py ../../results/isoforms/L3_isoforms.tsv > ../../results/new_isoforms/L3_new_isoforms.tsv

./annotate_bedUTRs.py ../../results/isoforms/L3_isoforms.tsv ../../data/L3/combined/L3_full_length.no_intron.bed ../../data/L3/combined/L3_full_length.no_intron.annotated.bed

echo "L4"
# cat full_lengths/realigned/split/ce11_gen_L4_bio1_tech1_Minimap2_k14.ss_filtered.bed full_lengths/realigned/split/ce11_gen_L4_bio1_tech2_Minimap2_k14.ss_filtered.bed > full_lengths/realigned/L4_full_length.bed
#
# ./correctBed12_v9.py full_lengths/realigned/L4_full_length.realign.bed correctionLogs/L4_realigned > full_lengths/realigned/L4_full_length.corrected.bed
#
# ./filter_intron_retained.py full_lengths/realigned/L4_full_length.corrected.bedfa full_lengths/realigned/L4_full_length.no_intron.bedfa full_lengths/realigned/L4_full_length.intron.bedfa

bedtools getfasta -s -split -bedOut -fi ../../references/ce11/ce11.fa -bed ../../data/L4/combined/L4_full_length.no_intron.bed > ../../data/L4/combined/L4_full_length.no_intron.bedfa

./extractIsoforms.py ../../results/correctionLogs/L4.gene.txt ../../data/L4/combined/L4_full_length.no_intron.bedfa ../../results/isoforms/L4_isoforms.tsv

./getNewIsoforms.py ../../results/isoforms/L4_isoforms.tsv > ../../results/new_isoforms/L4_new_isoforms.tsv

./annotate_bedUTRs.py ../../results/isoforms/L4_isoforms.tsv ../../data/L4/combined/L4_full_length.no_intron.bed ../../data/L4/combined/L4_full_length.no_intron.annotated.bed

echo "Young adult"
# cat full_lengths/realigned/split/ce11_gen_young_adult_bio1_tech1_Minimap2_k14.ss_filtered.bed full_lengths/realigned/split/ce11_gen_young_adult_bio1_tech2_Minimap2_k14.ss_filtered.bed > full_lengths/realigned/YA_full_length.bed
#
# ./correctBed12_v9.py full_lengths/realigned/YA_full_length.realign.bed correctionLogs/YA_realigned > full_lengths/realigned/YA_full_length.corrected.bed
#
# ./filter_intron_retained.py full_lengths/realigned/YA_full_length.corrected.bedfa full_lengths/realigned/YA_full_length.no_intron.bedfa full_lengths/realigned/YA_full_length.intron.bedfa

bedtools getfasta -s -split -bedOut -fi ../../references/ce11/ce11.fa -bed ../../data/young_adult/combined/YA_full_length.no_intron.bed > ../../data/young_adult/combined/YA_full_length.no_intron.bedfa

./extractIsoforms.py ../../results/correctionLogs/YA.gene.txt ../../data/young_adult/combined/YA_full_length.no_intron.bedfa ../../results/isoforms/YA_isoforms.tsv

./getNewIsoforms.py ../../results/isoforms/YA_isoforms.tsv > ../../results/new_isoforms/YA_new_isoforms.tsv

./annotate_bedUTRs.py ../../results/isoforms/YA_isoforms.tsv ../../data/young_adult/combined/YA_full_length.no_intron.bed ../../data/young_adult/combined/YA_full_length.no_intron.annotated.bed

echo "Gravid adult"
# cat full_lengths/realigned/split/ce11_gen_adult_bio1_tech1_Minimap2_k14.ss_filtered.bed full_lengths/realigned/split/ce11_gen_adult_bio1_tech2_Minimap2_k14.ss_filtered.bed >full_lengths/realigned/GA_full_length.bed
#
# ./correctBed12_v9.py full_lengths/realigned/GA_full_length.realign.bed correctionLogs/GA_realigned > full_lengths/realigned/GA_full_length.corrected.bed
#
# ./filter_intron_retained.py full_lengths/realigned/GA_full_length.corrected.bedfa full_lengths/realigned/GA_full_length.no_intron.bedfa full_lengths/realigned/GA_full_length.intron.bedfa

bedtools getfasta -s -split -bedOut -fi ../../references/ce11/ce11.fa -bed ../../data/adult/combined/GA_full_length.no_intron.bed > ../../data/adult/combined/GA_full_length.no_intron.bedfa

./extractIsoforms.py ../../results/correctionLogs/GA.gene.txt ../../data/adult/combined/GA_full_length.no_intron.bedfa ../../results/isoforms/GA_isoforms.tsv

./getNewIsoforms.py ../../results/isoforms/GA_isoforms.tsv > ../../results/new_isoforms/GA_new_isoforms.tsv

./annotate_bedUTRs.py ../../results/isoforms/GA_isoforms.tsv ../../data/adult/combined/GA_full_length.no_intron.bed ../../data/adult/combined/GA_full_length.no_intron.annotated.bed

echo "Male"
# cat full_lengths/realigned/split/ce11_gen_male_bio1_tech1_Minimap2_k14.ss_filtered.bed full_lengths/realigned/split/ce11_gen_male_bio1_tech2_Minimap2_k14.ss_filtered.bed >full_lengths/realigned/ML_full_length.bed
#
# ./correctBed12_v9.py full_lengths/realigned/ML_full_length.realign.bed correctionLogs/ML_realigned > full_lengths/realigned/ML_full_length.corrected.bed
# 
# ./filter_intron_retained.py full_lengths/realigned/ML_full_length.corrected.bedfa full_lengths/realigned/ML_full_length.no_intron.bedfa full_lengths/realigned/ML_full_length.intron.bedfa

bedtools getfasta -s -split -bedOut -fi ../../references/ce11/ce11.fa -bed ../../data/male/combined/ML_full_length.no_intron.bed > ../../data/male/combined/ML_full_length.no_intron.bedfa

./extractIsoforms.py ../../results/correctionLogs/ML.gene.txt ../../data/male/combined/ML_full_length.no_intron.bedfa ../../results/isoforms/ML_isoforms.tsv

./getNewIsoforms.py ../../results/isoforms/ML_isoforms.tsv > ../../results/new_isoforms/ML_new_isoforms.tsv

./annotate_bedUTRs.py ../../results/isoforms/ML_isoforms.tsv ../../data/male/combined/ML_full_length.no_intron.bed ../../data/male/combined/ML_full_length.no_intron.annotated.bed

##COMPARE
./combine_realigned_isoform_reports.py > ../../results/isoforms/all_isoforms.tsv
./extractUTRs.py ../../results/isoforms/all_isoforms.tsv ../../results/utrs/beds/all_isoforms_utrs.bed ../../results/utrs/assignments/all_isoforms_utrs.tsv
./combine_new_isoform_reports.py > ../../results/new_isoforms/all_new_isoforms.tsv
